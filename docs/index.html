<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Synchronized Tooltips â€” Chart.js 4</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .chart-container {
            width: 800px;
            height: 250px; /* reduced container height */
            margin: 20px auto;
            background: white;
            padding: 10px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        canvas {
            width: 100%;
            height: 100%; /* canvas fills container */
        }
    </style>
</head>
<body>
<h2>Chart.js 4 synchronized tooltips plugin</h2>
<div id="charts"></div>

<script>
    "use strict";if(typeof Chart<"u"){const D={id:"chartjs-sync-tooltips",afterInit(e){var c,o;const n=(o=(c=e.config.options)==null?void 0:c.plugins)==null?void 0:o.sync;if(!(n!=null&&n.enabled))return;const{group:t}=n,i=u=>{var x;const{chartId:d,syncGroup:s,xValue:f}=u.detail;if(d===e.id||s!==t)return;const y=((x=e.scales)==null?void 0:x.x)||e.scales[e.getDatasetMeta(0).xAxisID],{labels:a}=e.data;if(!y||!a||a.length===0)return;const E=typeof a[0]=="number",v=E?f:new Date(f).getTime();let m=0,w=a.length-1,g=0,b=1/0;for(;m<=w;){const l=Math.floor((m+w)/2),p=E?a[l]:new Date(a[l]).getTime(),I=Math.abs(p-v);if(I<b&&(b=I,g=l),p<v)m=l+1;else if(p>v)w=l-1;else break}const h=e.data.datasets.map((l,p)=>l.data&&g<l.data.length?{datasetIndex:p,index:g}:null).filter(Boolean);e.tooltip.setActiveElements(h,{x:y.getPixelForValue(a[g]),y:null}),e.update()},r=u=>{const{chartId:d,syncGroup:s}=u.detail;d===e.id||s!==t||(e.tooltip.setActiveElements([],{x:0,y:0}),e.update())};e._sync={group:t,handleSync:i,handleHide:r},window.addEventListener("sync-event",i),window.addEventListener("sync-hide",r)},afterDestroy(e){if(!e._sync)return;const{handleSync:n,handleHide:t}=e._sync;window.removeEventListener("sync-event",n),window.removeEventListener("sync-hide",t)},afterEvent(e,n){var d,s,f,y;const t=n.event,i=(d=e.config.options.plugins)==null?void 0:d.sync;if(!(i!=null&&i.enabled)||!e.scales)return;const r=((f=(s=e.tooltip)==null?void 0:s.getActiveElements)==null?void 0:f.call(s))||[];if(r.length===0&&!t.stop){window.dispatchEvent(new CustomEvent("sync-hide",{detail:{chartId:e.id,syncGroup:i.group}}));return}const c=(y=r[0])==null?void 0:y.index;if(typeof c!="number")return;const o=e.data.labels[c];if(o==null)return;const u=typeof o=="string"?new Date(o).getTime():o;t.stop||window.dispatchEvent(new CustomEvent("sync-event",{detail:{chartId:e.id,syncGroup:i.group,original:t,xValue:u}}))},beforeTooltipDraw(){return!0}};Chart.register(D)}

    // --- Helper: generate smoothed random data ---
    function generateSmoothedData(startDate, count, stepMinutes, startValue = 50, delta = 5) {
        const labels = [];
        const values = [];
        let current = new Date(startDate);
        let y = startValue;
        for (let i = 0; i < count; i++) {
            labels.push(new Date(current));
            y += Math.floor(Math.random() * 2 * delta - delta); // small random change
            values.push(y);
            current.setMinutes(current.getMinutes() + stepMinutes);
        }
        return { labels, values };
    }

    // --- Parameters ---
    const startDate = "2023-01-01T00:00:00";
    const pointsCount = 100;
    const stepMinutes = 60;

    // --- Chart configurations ---
    const lineCharts = [
        { title: "Chart A", color: "blue" },
        { title: "Chart B", color: "red" },
        { title: "Chart C", color: "green" }
    ];

    const container = document.getElementById("charts");

    // --- Generate charts ---
    lineCharts.forEach(cfg => {
        const div = document.createElement("div");
        div.className = "chart-container";
        const canvas = document.createElement("canvas");
        div.appendChild(canvas);
        container.appendChild(div);

        const { labels, values } = generateSmoothedData(startDate, pointsCount, stepMinutes);

        new Chart(canvas, {
            type: "line",
            data: {
                labels: labels,
                datasets: [{
                    label: cfg.title,
                    data: values,
                    borderColor: cfg.color,
                    fill: false,       // pure line, no area
                    tension: 0.3       // slight smoothing
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false, // let canvas fill container height
                scales: {
                    x: {
                        type: "time",
                        time: { unit: "day", tooltipFormat: "dd.MM.yyyy HH:mm" },
                        title: { display: true, text: "Time" }
                    },
                    y: {
                        title: { display: true, text: "Value" }
                    }
                },
                plugins: {
                    sync: { enabled: true, group: 'ourCharts' },
                    title: { display: true, text: cfg.title }
                }
            }
        });
    });
</script>
</body>
</html>
